{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">Delivery {{ document.reference }}</h2>

<ul class="nav nav-tabs mb-3">
  <li class="nav-item"><a class="nav-link" href="{% url 'inventory:dashboard' %}">Dashboard</a></li>
  <li class="nav-item"><a class="nav-link active" href="{% url 'inventory:delivery_operations' %}">Operations</a></li>
  <li class="nav-item"><a class="nav-link" href="{% url 'inventory:stock_list' %}">Stock</a></li>
  <li class="nav-item"><a class="nav-link" href="{% url 'inventory:move_history' %}">Move History</a></li>
  <li class="nav-item"><a class="nav-link" href="{% url 'inventory:settings' %}">Settings</a></li>
</ul>

<div class="mb-3">
  <a href="{% url 'inventory:delivery_operations' %}" class="btn btn-secondary btn-sm me-2">Back</a>
  <a href="{% url 'inventory:delivery_print' document.id %}" class="btn btn-outline-secondary btn-sm me-2" target="_blank">Print</a>
  {% if document.status != 'done' and document.status != 'canceled' %}
    <a href="{% url 'inventory:delivery_cancel' document.id %}" class="btn btn-outline-danger btn-sm me-2">Cancel</a>
  {% endif %}
  {% if document.status != 'done' %}
    <a href="{% url 'inventory:delivery_validate' document.id %}" class="btn btn-primary btn-sm">Validate</a>
  {% endif %}
</div>

<div class="mb-3">
  <span class="badge bg-secondary">Draft</span>
  <span>&gt;</span>
  <span class="badge bg-warning text-dark">Waiting</span>
  <span>&gt;</span>
  <span class="badge bg-info text-dark">Ready</span>
  <span>&gt;</span>
  <span class="badge bg-success">Done</span>
</div>

<div class="row mb-4">
  <div class="col-md-6">
    <p><strong>From:</strong> {{ document.source_location }}</p>
    <p><strong>To:</strong> {{ document.destination_location }}</p>
    <p><strong>Contact:</strong> {{ document.contact_name }}</p>
  </div>
  <div class="col-md-6">
    <p><strong>Schedule Date:</strong> {{ document.scheduled_date|default:"-" }}</p>
    <p><strong>Responsible:</strong> {{ document.created_by|default:"-" }}</p>
    <p><strong>Status:</strong> {{ document.get_status_display }}</p>
  </div>
</div>

<h5>Products</h5>
<table class="table table-sm">
  <thead>
    <tr>
      <th>Product</th>
      <th>Quantity</th>
      <th>Available at Source</th>
    </tr>
  </thead>
  <tbody>
  {% for item in line_infos %}
    <tr class="{% if item.is_short %}table-danger{% endif %}">
      <td>{{ item.line.product }}</td>
      <td>{{ item.line.quantity }}</td>
      <td>{{ item.available }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="3" class="text-muted">No products on this delivery.</td></tr>
  {% endfor %}
  </tbody>
</table>

<p class="small text-muted">
  Lines highlighted in red do not have enough stock at the source location.
</p>

<p>
  <a href="{% url 'inventory:delivery_edit' document.id %}" class="btn btn-outline-primary btn-sm">Add / Edit Products</a>
</p>
{% endblock %}


