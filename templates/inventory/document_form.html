{% extends "base.html" %}
{% load form_tags %}
{% block content %}
<h2 class="mb-3">{{ title }}</h2>

<form method="post">
  {% csrf_token %}
  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {% for error in form.non_field_errors %}{{ error }}{% endfor %}
    </div>
  {% endif %}
  <div class="row">
    <div class="col-md-4">
      <div class="mb-3">
        <label class="form-label">Reference</label>
        {{ form.reference|add_class:"form-control" }}
        {% if form.reference.errors %}
          <div class="text-danger small">{{ form.reference.errors }}</div>
        {% endif %}
      </div>
      <div class="mb-3">
        <label class="form-label">{{ form.contact_name.label|default:"Contact" }}</label>
        {{ form.contact_name|add_class:"form-control" }}
        {% if form.contact_name.help_text %}
          <div class="form-text">{{ form.contact_name.help_text }}</div>
        {% endif %}
        {% if form.contact_name.errors %}
          <div class="text-danger small">{{ form.contact_name.errors }}</div>
        {% endif %}
      </div>
      {% if form.delivery_address %}
        <div class="mb-3">
          <label class="form-label">{{ form.delivery_address.label }}</label>
          {{ form.delivery_address|add_class:"form-control" }}
          {% if form.delivery_address.help_text %}
            <div class="form-text">{{ form.delivery_address.help_text }}</div>
          {% endif %}
          {% if form.delivery_address.errors %}
            <div class="text-danger small">{{ form.delivery_address.errors }}</div>
          {% endif %}
        </div>
      {% endif %}
      {% if form.source_location %}
        <div class="mb-3">
          <label class="form-label">{{ form.source_location.label }}</label>
          {{ form.source_location|add_class:"form-select" }}
          {% if form.source_location.help_text %}
            <div class="form-text">{{ form.source_location.help_text }}</div>
          {% endif %}
          {% if form.source_location.errors %}
            <div class="text-danger small">{{ form.source_location.errors }}</div>
          {% endif %}
        </div>
      {% endif %}
      {% if form.destination_location %}
        <div class="mb-3">
          <label class="form-label">{{ form.destination_location.label }}</label>
          {{ form.destination_location|add_class:"form-select" }}
          {% if form.destination_location.help_text %}
            <div class="form-text">{{ form.destination_location.help_text }}</div>
          {% endif %}
          {% if form.destination_location.errors %}
            <div class="text-danger small">{{ form.destination_location.errors }}</div>
          {% endif %}
        </div>
      {% endif %}
      <div class="mb-3">
        <label class="form-label">Scheduled Date</label>
        {{ form.scheduled_date|add_class:"form-control" }}
        {% if form.scheduled_date.errors %}
          <div class="text-danger small">{{ form.scheduled_date.errors }}</div>
        {% endif %}
      </div>
    </div>
    <div class="col-md-8">
      <h5>Lines</h5>
      {{ formset.management_form }}
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Delete?</th>
          </tr>
        </thead>
        <tbody>
        {% for line_form in formset.forms %}
          <tr>
            <td>{{ line_form.product|add_class:"form-select" }}{% if line_form.product.errors %}<div class="text-danger small">{{ line_form.product.errors }}</div>{% endif %}</td>
            <td>{{ line_form.quantity|add_class:"form-control" }}{% if line_form.quantity.errors %}<div class="text-danger small">{{ line_form.quantity.errors }}</div>{% endif %}</td>
            <td>{{ line_form.DELETE }}</td>
          </tr>
          {% if line_form.errors %}
            <tr>
              <td colspan="3" class="text-danger">
                {% for error in line_form.non_field_errors %}{{ error }}{% endfor %}
              </td>
            </tr>
          {% endif %}
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <button class="btn btn-primary" type="submit">Validate &amp; Save</button>
</form>
{% endblock %}


